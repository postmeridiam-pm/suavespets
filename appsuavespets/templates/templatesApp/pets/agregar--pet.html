{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Formulario de pets</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{% static 'css/pets/agregar-pet.css' %}" />
</head>
<body class="bg-light">

<div class="header-fundacion">Fundaci칩n Pet</div>
<a href="/" class="btn-home-topright">游 Ir a Home</a>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-5">
          <h1 class="text-center mb-4 text-morado-oscuro fw-bold">A침adir Nueva pet</h1>
          <form id="form-pet" enctype="multipart/form-data" class="formulario-pet" novalidate>
            <div class="mb-3">
              <label for="nombre_pet" class="form-label">Nombre</label>
              <input type="text" id="nombre_pet" name="nombre_pet"
                pattern="[A-Za-z츼칄칈칍칔치칠칤칩칰칌침\s]{1,50}"
                maxlength="50" title="Solo letras y espacios, m치ximo 50 caracteres"
                required class="form-control" />
            </div>

            <div class="mb-3">
              <label for="descripcion_pet" class="form-label">Descripci칩n</label>
              <textarea id="descripcion_pet" name="descripcion_pet" minlength="10" maxlength="200" required
                placeholder="Describe aqu칤 el temperamento de la pet, si posee alg칰n problema de salud y otros aspectos que consideres relevantes."
                class="form-control"></textarea>
              <small class="form-text error d-none" id="desc-error">Debe tener al menos 10 caracteres.</small>
            </div>

            <div class="mb-3">
              <label for="especie" class="form-label">Especie</label>
              <select id="especie" name="especie" required class="form-select">
                <option value="">Seleccione...</option>
                <option value="Perro">Perro</option>
                <option value="Gato">Gato</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="tamano" class="form-label">Tama침o</label>
              <select id="tamano" name="tamanio" required class="form-select">
                <option value="">Seleccione...</option>
                <option value="Gigante">Gigante</option>
                <option value="Grande">Grande</option>
                <option value="Mediano">Mediano</option>
                <option value="Peque침o">Peque침o</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="sexo" class="form-label">Sexo</label>
              <select id="sexo" name="sexo" required class="form-select">
                <option value="">Seleccione...</option>
                <option value="Hembra">Hembra</option>
                <option value="Macho">Macho</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="raza" class="form-label">Raza</label>
              <select id="raza" name="raza" required class="form-select">
                <option value="">Seleccione...</option>
                <option value="Mestizo" class="raza-small">Mestizo</option>
                <option value="Otra" class="raza-small">Otra</option>
              </select>
            </div>
            <div class="mb-3 d-none" id="otra-raza-container">
              <label for="otra_raza" class="form-label">Especifique otra raza:</label>
              <input type="text" id="otra_raza" name="otra_raza" maxlength="20"
                title="Solo letras y espacios, m치ximo 20 caracteres"
                pattern="[A-Za-z츼칄칈칍칔치칠칤칩칰칌침\s]{1,20}" class="form-control" />
            </div>

            <div class="mb-3">
              <label for="edad" class="form-label">Edad</label>
              <input type="number" id="edad" name="edad" min="0" max="100"
                placeholder="Ingrese la edad en a침os" class="form-control" />
              <button type="button" id="btn-no-determinar" class="btn btn-outline-danger mt-2">
                No se puede determinar
              </button>
            </div>

            <div class="mb-3">
              <label for="imagen" class="form-label">Imagen</label>
              <input type="file" id="imagen" name="imagen" accept="image/*" class="form-control" />
            </div>

            <div class="mb-3">
              <label for="numero_ficha" class="form-label">N칰mero de ficha</label>
              <div class="input-group">
                <span class="input-group-text">F000</span>
                <input type="number" id="numero_ficha" name="numero_ficha" min="0" max="9999"
                  placeholder="0000" pattern="\d{4}" title="Ingrese un n칰mero de 0 a 9999"
                  required class="form-control" />
              </div>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-morado-principal btn-lg">Guardar pet</button>
            </div>
          </form>

          <div class="text-center mt-4 d-flex justify-content-center gap-2">
            <a href="{% url 'listado_pets' %}" class="btn btn-outline-morado-claro">Volver al listado de pets</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Patita emoji en esquina inferior derecha -->
<div class="footer-patita" aria-hidden="true">游</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
 // TU VALIDACI칍N JS AQU칈 (id칠ntica a como la tienes, no se borra nada)

 // A칌ADE ESTO para POST a tu API RESTful:
 document.getElementById('form-pet').addEventListener('submit', function(e) {
   e.preventDefault();

   // Corrobora tus propias validaciones JS aqu칤...

   const formData = new FormData(this);
   fetch('/api/pets/', {
     method: 'POST',
     headers: { 'X-CSRFToken': (document.cookie.match(/csrftoken=([^;]+)/)||[])[1] || '' },
     body: formData
   })
   .then(resp => {
     if(resp.ok) return resp.json();
     return resp.json().then(e => Promise.reject(e));
   })
   .then(data => {
     alert('Mascota agregada exitosamente');
     this.reset();
   })
   .catch(err => {
     alert('Error al agregar mascota: ' + JSON.stringify(err));
   });
 });
</script>
</body>
</html>
